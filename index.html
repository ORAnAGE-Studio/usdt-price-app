<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Price in JPY</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #ffffff;
    }
    h1 {
      text-align: center;
      margin: 20px 0;
      color: #fbfbfb;
    }
    .usd-jpy {
      display: block;
      font-size: 1.8rem;
      font-weight: bold;
      color: #00e676;
      margin-top: 10px;
    }
    .other-rates {
      display: block;
      font-size: 1.2rem;
      color: #bdbdbd;
      margin-top: 5px;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background-color: #1e1e1e;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    th, td {
      padding: 15px;
      text-align: center;
      border: 1px solid #333;
    }
    th {
      background-color: #282828;
      color: #ffffff;
      font-weight: bold;
    }
    td {
      color: #e0e0e0;
    }
    tr:hover {
      background-color: #333333;
    }
    .price-diff {
      font-size: 1rem;
      padding: 5px;
      border-radius: 5px;
      display: inline-block;
    }
    .price-diff.up {
      color: #ff5252;
      background-color: #331010;
    }
    .price-diff.down {
      color: #448aff;
      background-color: #101533;
    }
    .flag {
      width: 24px;
      height: auto;
      vertical-align: middle;
      margin-right: 8px;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      color: #bdbdbd;
      font-size: 0.9rem;
    }
    footer a {
      color: #ea7414;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>
    USDT Price in JPY
    <span id="usd-jpy-rate" class="usd-jpy"></span>
    <span id="other-rates" class="other-rates"></span>
  </h1>
  <table>
    <thead>
      <tr>
        <th>Exchange</th>
        <th>Country</th>
        <th>Currency</th>
        <th>Price (Local)</th>
        <th>Price (JPY)</th>
        <th>Price Difference (%)</th>
      </tr>
    </thead>
    <tbody id="price-table-body">
      <!-- Dynamic content -->
    </tbody>
  </table>
  <footer>
    <p>Powered by <a href="" target="_blank">ORAnAGE Studio</a>. All rights reserved.</p>
  </footer>
  <script>
    const API_URL = window.location.origin.includes("localhost")
      ? "http://localhost:3000/api/prices" // ローカル環境
      : "https://usdt-price-app-web.vercel.app/api/prices"; // 本番環境

    const countryFlags = {
      Vietnam: "https://flagcdn.com/w320/vn.png",
      Taiwan: "https://flagcdn.com/w320/tw.png",
      Japan: "https://flagcdn.com/w320/jp.png",
      Korea: "https://flagcdn.com/w320/kr.png",
      USA: "https://flagcdn.com/w320/us.png"
    };

    async function fetchPrices() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        const usdJpyRateElement = document.getElementById("usd-jpy-rate");
        usdJpyRateElement.textContent = `USD/JPY: ${data.exchangeRates.USDJPY?.toFixed(4) || "N/A"}`;

        const otherRatesElement = document.getElementById("other-rates");
        otherRatesElement.textContent = `
          KRW/JPY: ${data.exchangeRates.KRWJPY?.toFixed(4) || "N/A"},
          VND/JPY: ${data.exchangeRates.VNDJPY?.toFixed(4) || "N/A"},
          TWD/JPY: ${data.exchangeRates.TWDJPY?.toFixed(4) || "N/A"}
        `;

        const tableBody = document.getElementById("price-table-body");
        tableBody.innerHTML = "";

        const usdJpyRate = data.exchangeRates.USDJPY || 1;

        data.usdtPrices.forEach((item) => {
          const priceInJPY = parseFloat(item.priceInJPY) || "N/A";
          const priceDifference = priceInJPY !== "N/A"
            ? ((priceInJPY - usdJpyRate) / usdJpyRate) * 100
            : 0;

          const diffText =
            priceDifference > 0
              ? `+${priceDifference.toFixed(2)}% ↑`
              : priceDifference < 0
              ? `${priceDifference.toFixed(2)}% ↓`
              : "-";
          const diffClass = priceDifference > 0 ? "price-diff up" : "price-diff down";

          const countryFlag = countryFlags[item.country] || "";

          const row = `
            <tr>
              <td>${item.exchange}</td>
              <td><img src="${countryFlag}" alt="${item.country}" class="flag"></td>
              <td>${item.currency}</td>
              <td>${item.localPrice !== "N/A" ? item.localPrice.toFixed(4) : "N/A"}</td>
              <td>${priceInJPY !== "N/A" ? priceInJPY.toFixed(4) : "N/A"}</td>
              <td><span class="${priceInJPY !== "N/A" ? diffClass : ""}">${diffText}</span></td>
            </tr>
          `;
          tableBody.innerHTML += row;
        });
      } catch (error) {
        console.error("Error fetching prices:", error);
      }
    }

    setInterval(fetchPrices, 5000);
    fetchPrices();
  </script>
</body>
</html>